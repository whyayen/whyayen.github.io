(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{492:function(s,a,e){"use strict";e.r(a);var t=e(4),r=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"summary"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#summary"}},[s._v("#")]),s._v(" Summary")]),s._v(" "),e("p",[s._v("前一陣子在使用 ELK，想把 MySQL 的資料 sync 到 ELK，需要把 MySQL 設為可以給外部連線，所以紀錄一下有哪些步驟。")]),s._v(" "),e("h2",{attrs:{id:"step-1-編輯-mysql-config"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#step-1-編輯-mysql-config"}},[s._v("#")]),s._v(" Step 1. 編輯 MySQL config")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/mysql/mysql.conf.d/mysqld.cnf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"step-2-編輯-bind-address-為-0-0-0-0"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#step-2-編輯-bind-address-為-0-0-0-0"}},[s._v("#")]),s._v(" Step 2. 編輯 bind-address 為 0.0.0.0")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("#\n# Instead of skip-networking the default is now to listen only on\n# localhost which is more compatible and is not less secure.\nbind-address            = 127.0.0.1\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("修改成")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("bind-address            = 0.0.0.0\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("Restart MySQL")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" mysql restart\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("值為 "),e("code",[s._v("127.0.0.1")]),s._v(" 表示僅 localhost 可以進行連線，而如果設為 "),e("code",[s._v("0.0.0.0")]),s._v(" 則允許外部連到 MySQL。")]),s._v(" "),e("h2",{attrs:{id:"step-3-新增-mysql-使用者"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#step-3-新增-mysql-使用者"}},[s._v("#")]),s._v(" Step 3. 新增 MySQL 使用者")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'localhost'")]),s._v(" IDENTIFIED "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'user_password'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[e("code",[s._v("username")]),s._v(": 自行替換為你想要的使用者名稱")]),s._v(" "),e("li",[e("code",[s._v("localhost")]),s._v(": 此處為 host，如果值為 "),e("code",[s._v("localhost")]),s._v(" 表示僅允許這個使用者在這台機器上做連線，其他主機不行（SSH 除外），如果要外部連線，請設想連線主機的 IP，\b或也可以使用 "),e("code",[s._v("%")]),s._v(" 代表任何主機都可以進行連線，請謹慎使用 "),e("code",[s._v("%")]),s._v("，盡量將權限、可連線的來源最小化。")]),s._v(" "),e("li",[e("code",[s._v("user_password")]),s._v(": 使用者密碼")])]),s._v(" "),e("h2",{attrs:{id:"step-4-grant-privileges"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#step-4-grant-privileges"}},[s._v("#")]),s._v(" Step 4. Grant privileges")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALL")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIVILEGES")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" database_name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("table_name "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'localhost'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DELETE")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" database_name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'localhost'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("新增使用者的權限，僅允許 "),e("code",[s._v("SELECT")]),s._v(", "),e("code",[s._v("INSERT")]),s._v(", "),e("code",[s._v("DELETE")]),s._v(", "),e("code",[s._v("ALL PRIVILEGES")]),s._v(" 等，並且可以指定資料庫及資料表，例如：我想新增使用者僅允許"),e("strong",[s._v("讀取")]),s._v(" "),e("code",[s._v("development")]),s._v(" 資料庫的 "),e("code",[s._v("users")]),s._v(" 資料表，則可以這樣設定：")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" development_"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("users "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jay'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'localhost'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("Revoke privileges")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REVOKE")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALL")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIVILEGES")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" database_name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'localhost'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"step-5-遠端連線"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#step-5-遠端連線"}},[s._v("#")]),s._v(" Step 5. 遠端連線")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("mysql -u username -p -h "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx.xxx.xxx.xxx'")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);